@using Sandbox;
@using Sandbox.UI;
@namespace Reprint
@inherits PanelComponent

<root>
	@{
		int limit = paint.width > paint.height ? paint.width : paint.height;
		float side = (0.5f * size - limit) / limit;
		string sidePx = (int)side + "px";
		string fontPx = (int)side + "px";
		for(var y = 0; y < paint.height; y++)
		{
			<div class="row">
			@for(var x = 0; x < paint.width; x++)
			{
				var pxl = paint.PixelAt(x, y);
				<div style="background-color: @pxl.FinalColor.Hex; color: @pxl.ContrastGray.Hex; border-color: @pxl.ContrastGray.Hex; width: @sidePx; height: @sidePx; font-size: @fontPx">@((x == paint.cursorX && y == paint.cursorY) ? "‚Øè" : "")</div>
			}
			</div>
		}
	}
</root>

@code
{
	[Property] public bool isScratch = false;
	[Property] public float size = 512.0f;
	public Painting paint;

	protected override void OnStart()
	{
		paint = isScratch ? Scene.Get<Toolbox>().scratchPaint : new(4, 4);
	}

	protected override int BuildHash() => System.HashCode.Combine( paint.BuildHash() );
}
